<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">


	<!-- +++++++++++++++++++++++++++++++++++++++ -->
	<!-- MODULE SETTINGS -->
	<!-- +++++++++++++++++++++++++++++++++++++++ -->

	<!-- MODULE: PROPERTIES -->
	<bean id="moduleProperties" class="org.springframework.beans.factory.config.MapFactoryBean">
		<property name="sourceMap">
			<map>
				<entry key="module.name" value="wmp+osDigit+arrowS+cc" />
				<entry key="module.version" value="1" />
				<entry key="module.author" value="James Stone" />
				<entry key="module.description" value="Implementation of the working memory period task (Towse et al, 2005) with self-generated stimuli followed by a digit operation span task" />
				<entry key="module.execution.display.classname" value="ch.tatool.core.display.swing.SwingExecutionDisplayProvider" />
				<entry key="module.execution.initializer.classname" value="ch.tatool.core.module.initializer.SpringExecutorInitializer" />
				<entry key="module.execution.display.regionsContainer" value="true" />
				<entry key="module.scheduler.classname" value="ch.tatool.core.module.scheduler.AlwaysAllowModuleScheduler" />
				<entry key="module.info.classname" value="ch.tatool.app.gui.ModuleInfoPanel" />
			</map>
		</property>
	</bean>

	<!-- MODULE: EXPORTERS -->
	<bean id="moduleExporters" class="org.springframework.beans.factory.config.MapFactoryBean">
		<property name="sourceMap">
			<map>
				<entry key="localExporter">
					<bean class="ch.tatool.app.export.FileDataExporter">
						<property name="incrementalExport" value="false" />
						<property name="autoExport" value="false" />
					</bean>
				</entry>
			</map>
		</property>
	</bean>


	<!-- +++++++++++++++++++++++++++++++++++++++ -->
	<!-- GENERAL SETTINGS -->
	<!-- +++++++++++++++++++++++++++++++++++++++ -->
	
	<!-- KEYBOARD HANDLER -->
	<bean id="keyHandler" class="ch.tatool.core.element.handler.EscapeKeyEventHandler">
		<!-- allow to exit module by pressing ESCAPE -->
		<property name="allowEscapeKey" value="true" />
	</bean>

	<!-- STATUS PANEL ON -->
	<bean id="status_panel_on"
		class="ch.tatool.core.display.swing.status.DefaultModuleStatusRegionConfigurator">
		<property name="panels">
			<list>
				<util:constant 
					static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_OUTCOME" />
				<util:constant 
					static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_TRIAL" />
				<util:constant 
					static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_LEVEL" />
				<util:constant 
					static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_BLOCK" />
				<util:constant 
					static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_CUSTOM_ONE" />
			</list>
		</property>
	</bean>

	<!-- STATUS PANEL OFF -->
	<bean id="status_panel_off"
		class="ch.tatool.core.display.swing.status.DefaultModuleStatusRegionConfigurator">
		<property name="panels">
			<list>
			</list>
		</property>
	</bean>
	
	<!-- Start of trial pause (get ready) -->
	<!-- displays a 'get ready' message for given duration prior to start of each trial -->
	<bean id="get-ready" class="ch.tatool.core.executable.HTMLExecutable">
		<property name="base" value="/instructions/" />
		<property name="pages">
			<list>
				<value>getReady.html</value>
			</list>
		</property>
		<property name="duration" value="1000" />
	</bean>
	
	<!-- +++++++++++++++++++++++++++++++++++++++ -->
	<!-- ITERATOR SETTINGS -->
	<!-- +++++++++++++++++++++++++++++++++++++++ -->

	<!-- TASK ITERATORS -->
	
	<bean id="wmp-block-handler" class="ch.tatool.core.element.IteratedListSelector">
		<property name="numIterations" value="1" />
	</bean>

	<bean id="iter_wmp" class="ch.tatool.core.element.IteratedListSelector">
		<!-- number of iterations -->
		<property name="numIterations" value="7" />
	</bean>
	
	<bean id="os_iterator" class="ch.tatool.core.element.IteratedListSelector">
		<!-- number of iterations -->
		<property name="numIterations" value="7" /> <!-- has to be 15 for proper administration -->
	</bean>
	
	<bean id="as_iterator" class="ch.tatool.core.element.IteratedListSelector">
		<!-- number of iterations -->
		<property name="numIterations" value="7" /> <!-- how many trials? Executable needs editing if you want anything different than 18 trials with 3 trials of each span length 2-7 therefore 18 trials -->
	</bean>
	
	<!-- finally this handler allows the researcher to set the number of blocks to execute -->
	<bean id="cc-block-handler" class="ch.tatool.core.element.IteratedListSelector">
		<property name="numIterations" value="1" />
	</bean>
	
	<bean id="cc-one-trial-handler" class="ch.tatool.core.element.IteratedListSelector">
		<property name="numIterations" value="1" /><!-- placeholder, gets reset by the executable depending on level -->
	</bean>
	
	<!-- this handler will allow the researcher to set how many trials they want within each block regardless of level and level changes within block -->
	<bean id="iter_cc_task" class="ch.tatool.core.element.IteratedListSelector">
		<property name="numIterations" value="7" />
	</bean>
	
	<!-- +++++++++++++++++++++++++++++++++++++++ -->
	<!-- TASK SETTINGS -->
	<!-- +++++++++++++++++++++++++++++++++++++++ -->

	<!-- WMP -->

	<bean id="wmp" class="stone.javatasks.executables.WorkingMemoryPeriod">
	</bean>

	<!-- COMPLEX SPAN NUMERICAL -->
	<bean id="word_span" class="stone.javatasks.executables.WordDigitSpan" >
		<property name="StimuliType" value="1" /> <!--1 for digits, 2 for words -->
		<!--<property name="WordBankFileName" value="random_100_words.txt" />  filename of txt word list in correct location -->
		<property name="complexSpan" value="1" /> <!-- set 1 if this is a complex span task (ie operation span), 0 if simple span, 
		this effects the span size trials that will be run -->
	</bean>

	<bean id="operation_processing" class="stone.javatasks.executables.OperationProcessingTask" />
	
	<!-- arrow span -->
	<bean id="arrow_span" class="stone.javatasks.executables.ArrowSpan" />
	
	<bean id="cc-trial" class="stone.javatasks.executables.ColourCorsi">
		<property name="startLevel" value="0" /> <!-- adds this value to startLevel which is 1 by default -->
	</bean>

	<!-- END OF TRIAL PAUSE -->
	<!-- inserts a short pause (blank screen) after each trial for a given duration -->
	<bean id="last-item" class="ch.tatool.core.executable.HTMLExecutable">
		<property name="base" value="/instructions/" />
		<property name="pages">
			<list>
				<value>endOfTrial.htm</value>
			</list>
		</property>
		<property name="duration" value="1000" />
	</bean>	
	
	<bean id="moduleHierarchy" class="ch.tatool.core.element.ListElement">

		<property name="handlers">
			<list>
				<bean id="main_iterator" class="ch.tatool.core.element.IteratedListSelector" />
				<bean class="ch.tatool.core.element.handler.pause.DefaultExecutionPauseHandler">
					<!-- interval between elements in milliseconds -->
					<property name="defaultInterElementPauseDuration" value="250" />
				</bean>
				<bean class="ch.tatool.core.element.handler.ExecutionFeedbackHandler" />
				<bean class="ch.tatool.core.element.handler.StatusPanelStateHandler">
					<property name="resetIds">
						<list>
							<util:constant static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_OUTCOME" />
						</list>
					</property>
					<property name="enableIds">
						<list>
							<util:constant static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_OUTCOME" />
							<util:constant static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_TRIAL" />
							<util:constant static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_BLOCK" />
							<util:constant static-field="ch.tatool.core.display.swing.status.StatusPanel.STATUS_PANEL_CUSTOM_ONE" />
						</list>
					</property>
					<property name="phase">
						<util:constant static-field="ch.tatool.exec.ExecutionPhase.PRE_PROCESS" />
					</property>
				</bean>
				<ref bean="keyHandler" />
			</list>
		</property>

		<property name="children">
			<list>
				<!-- WMP -->
				<!-- instruction -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="stone.javatasks.helperclasses.HTMLExecutable">
							<property name="base" value="/instructions/WorkingMemoryPeriod/" />
							<property name="pages">
								<list>
									<value>WorkingMemoryPeriodInstructions.html</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>

				<!-- GET READY TEXT -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<ref bean="get-ready" />
					</property>
				</bean>	


				<!-- Main Task -->
				
				<bean id="wmp-BLOCK" class="ch.tatool.core.element.ListElement">
					<property name="handlers">
						<list>
							<ref bean="wmp-block-handler" />
						</list>
					</property>
					
					<property name="children">
						<list>
						
							<!-- status panel on -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="status_panel_on" />
								</property>
							</bean>
				
							<bean id="wmp-list-block1" class="ch.tatool.core.element.ListElement">
								<property name="handlers">
									<list>
										<ref bean="iter_wmp" />
									</list>
								</property>

								<property name="children">
									<list>

										<bean class="ch.tatool.core.element.ExecutableElement">
											<property name="id" value="exec" />
											<property name="handlers">
												<list>
													<bean class="ch.tatool.core.element.handler.TrialCountHandler" />
													<bean class="ch.tatool.core.element.handler.DefaultTrialCountEvaluator" />
													<bean id="wmp-level" class="ch.tatool.core.element.handler.score.DefaultPointsAndLevelHandler">
														<property name="description" value="WMP Task" />
														<property name="sampleSize" value="3" />
														<property name="minThreshold" value="0" />
														<property name="maxThreshold" value="0" />
													</bean>
												</list>
											</property>
											<property name="executable">
												<ref bean="wmp" />
											</property>
										</bean>

									</list>
								</property>
							</bean>
							<!-- END OF BLOCK -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<bean class="ch.tatool.core.executable.HTMLExecutable">
										<property name="base" value="/instructions/" />
										<property name="pages">
											<list>
												<value>endOfBlock.htm</value>
											</list>
										</property>
									</bean>
								</property>
							</bean>
						</list>
					</property>
				</bean>

				<!-- END -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="ch.tatool.core.executable.HTMLExecutable">
							<property name="base" value="/instructions/" />
							<property name="pages">
								<list>
									<value>endOfModule.htm</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>
				
				
				
				<!-- End of the WMP task completely. -->
				
				<!-- COMPLEX SPAN NUMERICAL -->
				<!-- instruction -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="stone.javatasks.helperclasses.HTMLExecutable">
							<property name="base" value="/instructions/OperationSpan/" />
							<property name="pages">
								<list>
									<value>OperationSpanDigitInstructions.html</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>

				<!-- main task -->
				<bean id="os-list" class="ch.tatool.core.element.ListElement">
				
					<property name="handlers">
						<list>
							<ref bean="os_iterator" />
						</list>
					</property>

					<property name="children">
						<list>

							<!-- status panel on -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="status_panel_on" />
								</property>
							</bean>

							<bean id="comp" class="ch.tatool.core.element.CompoundElement">

								<property name="handlers">
									<list>
										<bean class="ch.tatool.core.element.CompoundSelector" />
										<bean class="ch.tatool.core.element.handler.TrialCountHandler" />
										<bean class="ch.tatool.core.element.handler.DefaultTrialCountEvaluator" />
									</list>
								</property>

								<property name="primary">
									<!-- storage task -->
									<bean class="ch.tatool.core.element.ExecutableElement">
										<property name="id" value="exec" />
										<property name="executable">
											<ref bean="word_span" />
										</property>
									</bean>
								</property>								

								<property name="secondary">
									<!-- processing -->
									<bean class="ch.tatool.core.element.ExecutableElement">
										<property name="id" value="exec" />
										<property name="executable">
											<ref bean="operation_processing" />
										</property>
									</bean>
								</property>
								
							</bean>

							<!-- end of trial pause -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="last-item" />
								</property>
							</bean>

						</list>
					</property>
				</bean>

				<!-- status panel off -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<ref bean="status_panel_off" />
					</property>
				</bean>


				<!-- END -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="ch.tatool.core.executable.HTMLExecutable">
							<property name="base" value="/instructions/" />
							<property name="pages">
								<list>
									<value>endOfModule.htm</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>
				
				<!--End of OS Digit task completely -->
				
				
				
				<!-- Start of Arrow Span -->
				
				<!-- instruction -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="stone.javatasks.helperclasses.HTMLExecutable">
							<property name="base" value="/instructions/ArrowSpan/" />
							<property name="pages">
								<list>
									<value>ArrowSpanInstructions.html</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>

				<!-- main task -->
				<bean id="as-list" class="ch.tatool.core.element.ListElement">
				
					<property name="handlers">
						<list>
							<ref bean="as_iterator" />
						</list>
					</property>

					<property name="children">
						<list>

							<!-- status panel on -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="status_panel_on" />
								</property>
							</bean>

							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="id" value="exec" />
								<property name="handlers">
									<list>
										<bean class="ch.tatool.core.element.handler.TrialCountHandler" />
										<bean class="ch.tatool.core.element.handler.DefaultTrialCountEvaluator" />
									</list>
								</property>
								<property name="executable">
									<ref bean="arrow_span" />
								</property>
							</bean>

							<!-- end of trial pause
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="last-item" />
								</property>
							</bean>-->

						</list>
					</property>
				</bean>

				<!-- status panel off -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<ref bean="status_panel_off" />
					</property>
				</bean>

				<!-- END -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="ch.tatool.core.executable.HTMLExecutable">
							<property name="base" value="/instructions/" />
							<property name="pages">
								<list>
									<value>endOfModule.htm</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>		


				<!-- END OF Arrow Span Task -->
				
				<!--COLOUR CORSI-->
				<!-- Display Instructions at start of task -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="stone.javatasks.helperclasses.HTMLExecutable">
							<property name="base" value="/instructions/ColourCorsi/" />
							<property name="pages">
								<list>
									<value>ColourCorsiInstructions.html</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>

				<!-- GET READY TEXT -->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<ref bean="get-ready" />
					</property>
				</bean>	
				
				<bean id="cc-BLOCK" class="ch.tatool.core.element.ListElement">
					<property name="handlers">
						<list>
							<ref bean="cc-block-handler" />
						</list>
					</property>
					
					<property name="children">
					
						<list>
							
							<!-- ACTIVATE STATUS PANEL -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<ref bean="status_panel_on" />
								</property>
							</bean>
							
							<bean id="cc-list-block1" class="ch.tatool.core.element.ListElement">
								<property name="handlers">
									<list>
										<ref bean="iter_cc_task" />
									</list>
								</property>

								<property name="children">
									<list>
									
										<bean id="individual-trial" class="ch.tatool.core.element.ListElement">
											<property name="handlers">
												<list>
													<ref bean="cc-one-trial-handler" />
												</list>
											</property>
											
											<property name="children">
												<list>

													<bean class="ch.tatool.core.element.ExecutableElement">
														<property name="id" value="exec" />
														<property name="handlers">
															<list>
																<bean class="ch.tatool.core.element.handler.TrialCountHandler" />
																<bean class="ch.tatool.core.element.handler.DefaultTrialCountEvaluator" />
																<bean id="cc-level" class="ch.tatool.core.element.handler.score.DefaultPointsAndLevelHandler">
																	<property name="description" value="CC Task" />
																	<property name="sampleSize" value="3" /><!-- needs to match block size -->
																	<property name="minThreshold" value="0" />
																	<property name="maxThreshold" value="0" />
																</bean>
															</list>
														</property>
														<property name="executable">
															<ref bean="cc-trial" />
														</property>
													</bean>								
												</list>
											</property>
										</bean>
										<!-- end of individual trial -->
									</list>
								</property>
							</bean>
							
							<!-- END OF BLOCK -->
							<bean class="ch.tatool.core.element.ExecutableElement">
								<property name="executable">
									<bean class="ch.tatool.core.executable.HTMLExecutable">
										<property name="base" value="/instructions/" />
										<property name="pages">
											<list>
												<value>endOfBlock.htm</value>
											</list>
										</property>
									</bean>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- END TASK-->
				<bean class="ch.tatool.core.element.ExecutableElement">
					<property name="executable">
						<bean class="ch.tatool.core.executable.HTMLExecutable">
							<property name="base" value="/instructions/" />
							<property name="pages">
								<list>
									<value>endOfModule.htm</value>
								</list>
							</property>
						</bean>
					</property>
				</bean>				
				

			</list>
		</property>

	</bean>

</beans>				
				